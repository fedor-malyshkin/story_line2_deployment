# Код развёртывания/конфигурирования проекта


## Скрипты для развертывания всех видов стенда (production/test/development)
### Основные требования к скриптам:
- полная автоматизация
- использование gradle
- использование [docker-compose](https://docs.docker.com/compose/) для управления
группой контейнеров
- использование [docker](https://docs.docker.com/) (один контейнер на сервис)
- использование [puppet](https://puppet.com/) (для управления конфигурациями и
 структурой ОС внутри контейнера)

### Общией замечания о сборке и запуске стенда
- стенд представляет собой коллекцию docker-контейнеров,
выполняющихся на одной или нескольких машинах (тестовый - на одной)
- существует несколько видов стэнда:
	* dev - стенд для разработки в котором всё ПО запускается вручную, кроме
	инфраструктурных компонентов
	* test - стенд для тестирования в котром все компоненты запускаются в полном
	объме, но стенд "заточен" под задачи тестирования
	* prod - полностью продуктивный стэнд
- сборка стенда осуществляется с помощью задач gradle-скрипта
("buildSrc/build-tasks.gradle")
- все параметры скриптов считываются из нескольких конфигурационных файлов,
используемых в зависимости от типа стенда (dev/test/prod)
- ВСЕ параметры создаваемых стэндов определены в одном или нескольких
properties-файлах (разных в зависимости от типа стенда)
- ВСЕ параметры создаваемых контейнеров в первую очередь определяются properties,
потом в Dockerfile, потом docker-compose.yml
- тип стенда по-умолчанию (dev) может быть переопределён параметром к скрипту
`gradle -Pproject.ext.stand_type=test`

### Процедура сборки и запуска стенда (команда "gradle runStand")
Важное замечание запуск самих контейнеров осуществляется с помощью docker - как следствие должны осуществляться с надлежащими полномочиями.

1. Осуществляется сборка проекта
1. формируются Dockerfile для контейнера (с учетом параметров)
1. формируются конфигурационные файлы для компонентов в контейнерах (с учетом параметров)
1. запускается docker-compose (в зависимости от вида стенда)
	2. Выполняется скачивание необходимых образов
	2. выполняются скрипты puppet для подготовки среды в нем
	2. осуществляется запуск контейнера (docker 'ENTRYPOINT')
1. Осуществляется запуск тестов (для test-стэнда)
